---
import Layout from "@/layouts/Layout.astro"
import { getSession } from "auth-astro/server"
import SignInPage from "./SignInPage.astro"

const session = await getSession(Astro.request)
---

<Layout title="form">
	{
		session ? (
			<article class="mx-auto w-10/12 rounded-lg bg-beaver-900 p-8 text-gray-300 sm:p-10 md:max-w-lg lg:max-w-2xl lg:p-20">
				<h2 class="mb-4 text-2xl font-semibold">PUBLICA TU ANUNCIO</h2>
				<p class="mb-6 text-xs text-gray-400">Publica tu anucio en un solo click</p>
				<form
					id="publicationForm"
					method="post"
					enctype="multipart/form-data"
					class="flex flex-col gap-4"
				>
					{/* title */}
					<label for="title" class="block text-xs font-medium text-gray-400 md:text-sm">
						Titulo
						<input
							type="text"
							id="title"
							name="title"
							placeholder="Titula tu servicio"
							class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-white shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150 sm:text-sm"
							required
							minlength="3"
							maxlength="50"
						/>
						<span class="error mt-1 text-sm text-red-500" data-error-for="title" />
					</label>

					{/* description */}
					<label for="description" class="block text-xs font-medium text-gray-400 md:text-sm">
						Descripción
						<textarea
							name="description"
							id="description"
							rows="3"
							placeholder="Describe destalles unicos de tu servicio"
							class="mt-1 block w-full rounded border border-gray-600 bg-gray-700 px-3 py-2 text-white focus:border-green-150 focus:outline-none focus:ring-green-150 sm:text-sm"
							required
						/>
						<span class="error mt-1 text-sm text-red-500" data-error-for="description" />
					</label>

					{/* vehicle_type */}
					<label
						for="vehicle_type_id"
						class="mt-7 block text-xs font-medium text-gray-400 md:text-sm"
					>
						Tipo de vehículo
						<select
							name="vehicle_type_id"
							id="vehicle_type_id"
							class="mt-1 block w-full cursor-pointer rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-sm font-medium shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150"
							required
						>
							<option class="w-100" value="cedan">
								Cedán
							</option>
							<option class="w-100" value="autobus">
								Autobus
							</option>
							<option class="w-100" value="autocaravana">
								Autocaravana
							</option>
							<option class="w-100" value="camper">
								Fulgoneta camper
							</option>
							<option class="w-100" value="furgon">
								Furgón
							</option>
							<option class="w-100" value="sprinter">
								Sprinter
							</option>
						</select>
						<span class="error mt-1 text-sm text-red-500" data-error-for="vehicle_type-id" />
					</label>

					{/* Price */}
					<label for="price" class="block text-xs font-medium text-gray-400 md:text-sm">
						Precio
						<input
							type="number"
							id="price"
							name="price"
							placeholder="Precio"
							class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-white shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150 sm:text-sm"
							required
						/>
						<span class="error mt-1 text-sm text-red-500" data-error-for="price" />
					</label>

					{/* city */}
					<label class="block text-xs font-medium text-gray-400 md:text-sm">
						Ciudad
						<select
							name="city_id"
							id="city_id"
							class="mt-1 block w-full cursor-pointer rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-sm font-medium shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150"
						>
							<option class="w-100" value="iquique">
								Iquique
							</option>
						</select>
						<span class="error mt-1 text-sm text-red-500" data-error-for="city_id" />
					</label>

					{/* departure_date */}
					<label
						for="departure_date"
						class="mt-7 block text-xs font-medium text-gray-400 md:text-sm"
					>
						Fecha de salida
						<input
							type="date"
							name="departure_date"
							id="departure_date"
							class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-white shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150 sm:text-sm"
							required
						/>
						<span class="error mt-1 text-sm text-red-500" data-error-for="departure_date" />
					</label>

					{/* departure_time */}
					<label for="departure_time" class="block text-xs font-medium text-gray-400 md:text-sm">
						Hora de salida
						<input
							type="time"
							name="departure_time"
							id="departure_time"
							class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-white shadow-sm focus:border-green-150 focus:outline-none focus:ring-green-150 sm:text-sm"
							required
						/>
						<span class="error mt-1 text-sm text-red-500" data-error-for="departure_time" />
					</label>

					{/* upload image */}
					<div class="relative">
						<label for="imageUpload" class="block text-xs font-medium text-gray-400 md:text-sm">
							Subir imagen
						</label>
						<div
							id="dropZone"
							class="dropZone mt-2 flex min-h-64 w-full cursor-pointer flex-col items-center justify-center overflow-auto rounded-lg border border-gray-700 bg-gray-900 text-center"
						>
							<p id="imageText" class="flex flex-col gap-2 text-xs md:text-sm">
								<span>Imagen de hasta 10 KB</span>
								<span>Drag & drop here</span>
							</p>
							<input
								type="file"
								class="hidden"
								id="imageUpload"
								name="imageUpload"
								accept="image/*"
								multiple
							/>
							<div id="imagePreview" class="hidden gap-3 sm:m-6" />
						</div>
						<span class="error mt-3 text-sm text-red-500" data-error-for="imageUpload" />
					</div>

					{/* post button */}
					<div class="mt-10 flex justify-end">
						<button
							type="submit"
							id="uploadButton"
							class="h-10 w-28 rounded-lg bg-white p-1 text-black hover:bg-green-150 hover:text-lg"
						>
							Publicar
						</button>
					</div>
				</form>
			</article>
		) : (
			<div class="flex items-center justify-center">
				<SignInPage />
			</div>
		)
	}
</Layout>

<script src="/src/lib/formHandler.ts"></script>
